<div 
  id="pet-container" 
  class="fixed z-50 pointer-events-none" 
  style="bottom: 0px; left: -100px;"
  transition:persist
>
  <img 
    id="pet-img"
    src="/cat-cute.gif" 
    alt="Gatito caminando" 
    class="w-16 h-16 rendering-pixelated" 
  />
</div>

<script>
    declare global {
    interface Window {
      petAnimationId: number;
    }
  }
  function initPet() {
    const container = document.getElementById('pet-container');
    const img = document.getElementById('pet-img');
    
  
    if (window.petAnimationId) cancelAnimationFrame(window.petAnimationId);
    
    if (!container || !img) return;

    let position = -100;
    let direction = 1;
    const speed = 1.5;

    function walk() {
      if (!container || !img) return;

      position += speed * direction;
      container.style.left = `${position}px`;

      if (position > window.innerWidth + 50) { 
        direction = -1; 
        img.style.transform = 'scaleX(-1)'; 
      } else if (position < -100) { 
        direction = 1; 
        img.style.transform = 'scaleX(1)'; 
      }

      // Guardamos el ID para poder cancelarlo si hace falta
      window.petAnimationId = requestAnimationFrame(walk);
    }

    walk();
  }

  document.addEventListener('astro:page-load', initPet);
  
  document.addEventListener('astro:before-swap', () => {
    if (window.petAnimationId) cancelAnimationFrame(window.petAnimationId);
  });
</script>

<style>
  .rendering-pixelated {
    image-rendering: pixelated;
  }
</style>
